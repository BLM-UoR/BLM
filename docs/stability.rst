Stability
=========


Modifications to the logarithmic profile are required in conditions of
non-neutral stability, using the results of **Monin-Obukhov theory**.
This theory of the surface layer derives relations between the vertical
variation of wind speed u(z) and potential temperature :math:`\theta(z)` (which
approximates the measured temperature T close to the surface), the
scaling factors for momentum and temperature, :math:`u^*` and :math:`T^*`,
and the **Monin‑Obukhov stability parameter**

.. math::
    :label: zl

    \frac{z'}{L} = - \frac{k\left( z - d \right)\frac{g}{\theta_{0}}\frac{H}{\rho c_{p}}}{u_{*}^{3}}

where `L` is the **Obukhov length** and `z^’= z - d`. NB: the surface
temperature :math:`\theta_0` is an absolute temperature (units: K). The
logarithmic profile relation can be rewritten for wind speed to include
the stability corrections

.. math::
    :label: u_z

    \bar{u}(z) = \frac{u_{*}}{k}\left\lbrack \ln\left( \frac{z - d}{z_{0}} \right) - \Psi_{m}\left( \frac{z - d}{L} \right) + \Psi_{m}\left( \frac{z_{0}}{L} \right) \right\rbrack

and similarly, for potential temperature:

.. math::
    :label: theta_z

    \bar{\theta}(z) = \theta_{0} + \frac{T_{*}}{k}\left\lbrack \ln\left( \frac{z - d}{z_{h}} \right) - \Psi_{h}\left( \frac{z - d}{L} \right) + \Psi_{h}\left( \frac{z_{h}}{L} \right) \right\rbrack

where the **turbulent temperature scale** `T_*` is given by
:math:`T_{*} = - \overline{w^{'}T^{'}}/u_{*} = - Q_{H}/(\rho C_{p}u_{*})`,
:math:`\Psi_{m}` is the **integral stability correction function** for momentum
and :math:`\Psi_{h}` is the integral stability correction function for heat.

.. #TODO: add/reference equations for Psi_m and Psi_h.

Note that both `T_*` and `z’ / L` have the opposite sign to `Q_H` (which is positive in unstable conditions and negative in stable conditions).
If `z’/z_0 \gg 1` then the third term can assumed to be negligible (Garratt 1992).

Other stability metrics include the Richardson number:

- Gradient
- Bulk
- Flux

**Bulk Richardson number** is the ratio of thermally produced turbulence and turbulence generated by vertical shear or the ratio of free or forced convection (thermal: mechanical)

.. math::
    :label: RB

    R_{B}=\frac{\left(g / T_{v}\right) \Delta \theta_{v} \Delta z}{(\Delta U)^{2}+(\Delta V)^{2}}

where `g` acceleration due to gravity, `T_V` virtual temperature, `\Delta \theta_{v}` change (difference) in potential temperature, `\Delta z` change in height
`\Delta U` change in `U` wind-speed, and `\Delta V` change in `V` wind-speed.


